import { PrismaClient } from '@prisma/client';
import * as bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Iniciando seed completo do banco de dados...');
  console.log('üìç Cen√°rio: Palmeira dos √çndios, AL');

  // Hash das senhas
  const hashedPassword = await bcrypt.hash('123456', 12);

  // 1. Criar Super Admin
  console.log('üëë Criando Super Admin...');
  const superAdmin = await prisma.usuario.upsert({
    where: { email: 'superadmin@nordev.com' },
    update: {},
    create: {
      email: 'superadmin@nordev.com',
      senha: hashedPassword,
      nome: 'Super Administrador',
      cpf: '00000000000',
      tipo_usuario: 'SUPER_ADMIN',
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
    },
  });

  console.log('‚úÖ Super Admin criado:', superAdmin.email);

  // 2. Criar Prefeitura de Palmeira dos √çndios
  console.log('üèõÔ∏è Criando Prefeitura Municipal de Palmeira dos √çndios...');
  const prefeitura = await prisma.prefeitura.upsert({
    where: { cnpj: '12345678000195' },
    update: {},
    create: {
      nome: 'Prefeitura Municipal de Palmeira dos √çndios',
      cnpj: '12345678000195',
      email_administrativo: 'admin@palmeiradosindios.al.gov.br',
      ativo: true,
      data_cadastro: new Date(),
      requer_cupom_fiscal: true,
    },
  });

  console.log('‚úÖ Prefeitura criada:', prefeitura.nome);

  // 3. Criar √ìrg√£os da Prefeitura
  console.log('üèõÔ∏è Criando √ìrg√£os da Prefeitura...');
  
  // Secretaria de Sa√∫de
  const secretariaSaude = await prisma.orgao.create({
    data: {
      prefeituraId: prefeitura.id,
      nome: 'Secretaria Municipal de Sa√∫de',
      sigla: 'SMS',
      ativo: true,
    },
  });

  // Secretaria de Assist√™ncia Social
  const secretariaAssistencia = await prisma.orgao.create({
    data: {
      prefeituraId: prefeitura.id,
      nome: 'Secretaria Municipal de Assist√™ncia Social',
      sigla: 'SMAS',
      ativo: true,
    },
  });

  console.log('‚úÖ √ìrg√£os criados: SMS e SMAS');

  // 4. Criar Categorias
  console.log('üìÇ Criando Categorias...');
  
  const categorias = [
    {
      prefeituraId: prefeitura.id,
      tipo_categoria: 'VEICULO',
      nome: 'Ambul√¢ncias',
      descricao: 'Ve√≠culos de emerg√™ncia m√©dica',
    },
    {
      prefeituraId: prefeitura.id,
      tipo_categoria: 'VEICULO',
      nome: 'Ve√≠culos Administrativos',
      descricao: 'Ve√≠culos para uso administrativo',
    },
    {
      prefeituraId: prefeitura.id,
      tipo_categoria: 'VEICULO',
      nome: 'Ve√≠culos de Assist√™ncia Social',
      descricao: 'Ve√≠culos para atendimento social',
    },
    {
      prefeituraId: prefeitura.id,
      tipo_categoria: 'MOTORISTA',
      nome: 'Motoristas de Emerg√™ncia',
      descricao: 'Motoristas habilitados para ve√≠culos de emerg√™ncia',
    },
    {
      prefeituraId: prefeitura.id,
      tipo_categoria: 'MOTORISTA',
      nome: 'Motoristas Administrativos',
      descricao: 'Motoristas para ve√≠culos administrativos',
    },
  ];

  const categoriasCriadas = [];
  for (const categoria of categorias) {
    const categoriaCriada = await prisma.categoria.create({
      data: categoria as any,
    });
    categoriasCriadas.push(categoriaCriada);
    console.log(`‚úÖ Categoria criada: ${categoria.nome}`);
  }

  // 5. Criar Usu√°rios da Prefeitura
  console.log('üë• Criando Usu√°rios da Prefeitura...');
  
  // Admin da Prefeitura
  const adminPrefeitura = await prisma.usuario.upsert({
    where: { email: 'admin@palmeiradosindios.al.gov.br' },
    update: {},
    create: {
      email: 'admin@palmeiradosindios.al.gov.br',
      senha: hashedPassword,
      nome: 'Maria Jos√© Silva Santos',
      cpf: '11111111111',
      tipo_usuario: 'ADMIN_PREFEITURA',
      prefeituraId: prefeitura.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82999999999',
    },
  });

  // Secret√°rio de Sa√∫de
  const secretarioSaude = await prisma.usuario.upsert({
    where: { email: 'saude@palmeiradosindios.al.gov.br' },
    update: {},
    create: {
      email: 'saude@palmeiradosindios.al.gov.br',
      senha: hashedPassword,
      nome: 'Dr. Jo√£o Carlos Oliveira',
      cpf: '22222222222',
      tipo_usuario: 'COLABORADOR_PREFEITURA',
      prefeituraId: prefeitura.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82988888888',
    },
  });

  // Secret√°rio de Assist√™ncia Social
  const secretarioAssistencia = await prisma.usuario.upsert({
    where: { email: 'assistencia@palmeiradosindios.al.gov.br' },
    update: {},
    create: {
      email: 'assistencia@palmeiradosindios.al.gov.br',
      senha: hashedPassword,
      nome: 'Ana Maria Ferreira',
      cpf: '33333333333',
      tipo_usuario: 'COLABORADOR_PREFEITURA',
      prefeituraId: prefeitura.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82977777777',
    },
  });

  console.log('‚úÖ Usu√°rios da Prefeitura criados');

  // 6. Criar Motoristas
  console.log('üöó Criando Motoristas...');
  
  const motoristas = [
    {
      prefeituraId: prefeitura.id,
      nome: 'Jos√© da Silva Santos',
      cpf: '44444444444',
      cnh: '12345678901',
      categoria_cnh: 'B',
      data_vencimento_cnh: new Date('2025-12-31'),
      telefone: '82966666666',
      email: 'jose.santos@palmeiradosindios.al.gov.br',
      endereco: 'Rua das Palmeiras, 123, Centro',
      ativo: true,
      observacoes: 'Motorista experiente com 15 anos de experi√™ncia',
    },
    {
      prefeituraId: prefeitura.id,
      nome: 'Maria das Gra√ßas Oliveira',
      cpf: '55555555555',
      cnh: '23456789012',
      categoria_cnh: 'B',
      data_vencimento_cnh: new Date('2026-06-30'),
      telefone: '82955555555',
      email: 'maria.oliveira@palmeiradosindios.al.gov.br',
      endereco: 'Rua do Com√©rcio, 456, Centro',
      ativo: true,
      observacoes: 'Motorista especializada em ve√≠culos de emerg√™ncia',
    },
    {
      prefeituraId: prefeitura.id,
      nome: 'Ant√¥nio Carlos Ferreira',
      cpf: '66666666666',
      cnh: '34567890123',
      categoria_cnh: 'B',
      data_vencimento_cnh: new Date('2025-09-15'),
      telefone: '82944444444',
      email: 'antonio.ferreira@palmeiradosindios.al.gov.br',
      endereco: 'Rua da Liberdade, 789, Centro',
      ativo: true,
      observacoes: 'Motorista para ve√≠culos administrativos',
    },
  ];

  const motoristasCriados = [];
  for (const motorista of motoristas) {
    const motoristaCriado = await prisma.motorista.create({
      data: motorista,
    });
    motoristasCriados.push(motoristaCriado);
    console.log(`‚úÖ Motorista criado: ${motorista.nome}`);
  }

  // 7. Criar Ve√≠culos
  console.log('üöë Criando Ve√≠culos...');
  
  const veiculos = [
    {
      prefeituraId: prefeitura.id,
      orgaoId: secretariaSaude.id,
      nome: 'Ambul√¢ncia UTI 01',
      placa: 'AL-1234',
      modelo: 'Ford Transit',
      ano: 2020,
      tipo_abastecimento: 'COTA' as any,
      ativo: true,
      capacidade_tanque: 80.0,
      tipo_veiculo: 'Ambulancia' as any,
      situacao_veiculo: 'Proprio' as any,
      periodicidade: 'Semanal' as any,
      quantidade: 100.0,
      apelido: 'Ambul√¢ncia da Sa√∫de',
      ano_fabricacao: 2019,
      chassi: '9BWZZZZZZZZZZZZZZ',
      renavam: '12345678901',
      cor: 'Branco',
      capacidade_passageiros: 8,
      observacoes: 'Ve√≠culo em excelente estado de conserva√ß√£o',
    },
    {
      prefeituraId: prefeitura.id,
      orgaoId: secretariaSaude.id,
      nome: 'Ambul√¢ncia B√°sica 02',
      placa: 'AL-5678',
      modelo: 'Mercedes Sprinter',
      ano: 2019,
      tipo_abastecimento: 'COTA' as any,
      ativo: true,
      capacidade_tanque: 70.0,
      tipo_veiculo: 'Ambulancia' as any,
      situacao_veiculo: 'Proprio' as any,
      periodicidade: 'Semanal' as any,
      quantidade: 80.0,
      apelido: 'Ambul√¢ncia B√°sica',
      ano_fabricacao: 2018,
      chassi: '9BWYYYYYYYYYYYYYY',
      renavam: '23456789012',
      cor: 'Branco',
      capacidade_passageiros: 6,
      observacoes: 'Ve√≠culo para atendimento b√°sico',
    },
    {
      prefeituraId: prefeitura.id,
      orgaoId: secretariaAssistencia.id,
      nome: 'Van Assist√™ncia Social',
      placa: 'AL-9012',
      modelo: 'Volkswagen Kombi',
      ano: 2021,
      tipo_abastecimento: 'COTA' as any,
      ativo: true,
      capacidade_tanque: 60.0,
      tipo_veiculo: 'Microonibus' as any,
      situacao_veiculo: 'Proprio' as any,
      periodicidade: 'Semanal' as any,
      quantidade: 60.0,
      apelido: 'Van Social',
      ano_fabricacao: 2020,
      chassi: '9BWXXXXXXXXXXXXXX',
      renavam: '34567890123',
      cor: 'Azul',
      capacidade_passageiros: 12,
      observacoes: 'Ve√≠culo para atendimento social',
    },
    {
      prefeituraId: prefeitura.id,
      orgaoId: secretariaSaude.id,
      nome: 'Carro Administrativo Sa√∫de',
      placa: 'AL-3456',
      modelo: 'Chevrolet Onix',
      ano: 2022,
      tipo_abastecimento: 'COTA' as any,
      ativo: true,
      capacidade_tanque: 50.0,
      tipo_veiculo: 'Carro' as any,
      situacao_veiculo: 'Proprio' as any,
      periodicidade: 'Semanal' as any,
      quantidade: 40.0,
      apelido: 'Carro Admin Sa√∫de',
      ano_fabricacao: 2021,
      chassi: '9BWWWWWWWWWWWWWWW',
      renavam: '45678901234',
      cor: 'Prata',
      capacidade_passageiros: 5,
      observacoes: 'Ve√≠culo administrativo da sa√∫de',
    },
  ];

  const veiculosCriados = [];
  for (const veiculo of veiculos) {
    const veiculoCriado = await prisma.veiculo.create({
      data: veiculo,
    });
    veiculosCriados.push(veiculoCriado);
    console.log(`‚úÖ Ve√≠culo criado: ${veiculo.nome} (${veiculo.placa})`);
  }

  // 8. Criar Empresas (Postos de Gasolina)
  console.log('üè¢ Criando Empresas (Postos de Gasolina)...');
  
  // Posto Dois Irm√£os
  const postoDoisIrmaos = await prisma.empresa.create({
    data: {
      nome: 'Posto Dois Irm√£os',
      cnpj: '12345678000123',
      uf: 'AL',
      endereco: 'BR-316, Km 15',
      endereco_completo: 'BR-316, Km 15, Palmeira dos √çndios - AL',
      contato: 'Jo√£o dos Santos',
      telefone: '82912345678',
      email: 'contato@postodoisirmaos.com.br',
      ativo: true,
      isPublic: true,
      tipo_empresa: 'POSTO_GASOLINA',
      bandeira: 'Dois Irm√£os',
      latitude: -9.4056,
      longitude: -36.6333,
      horario_funcionamento: '06:00 √†s 22:00',
      servicos_disponiveis: 'Abastecimento, Conveni√™ncia, Lavagem',
      formas_pagamento: 'Dinheiro, Cart√£o, PIX',
      avaliacao: 4.2,
      total_avaliacoes: 85,
    },
  });

  // Posto Ipiranga Vila Maria
  const postoIpiranga = await prisma.empresa.create({
    data: {
      nome: 'Posto Ipiranga Vila Maria',
      cnpj: '98765432000123',
      uf: 'AL',
      endereco: 'Rua Vila Maria, 456',
      endereco_completo: 'Rua Vila Maria, 456, Centro, Palmeira dos √çndios - AL',
      contato: 'Maria dos Santos',
      telefone: '82987654321',
      email: 'contato@postoipiranga.com.br',
      ativo: true,
      isPublic: true,
      tipo_empresa: 'POSTO_GASOLINA',
      bandeira: 'Ipiranga',
      latitude: -9.4089,
      longitude: -36.6367,
      horario_funcionamento: '24h',
      servicos_disponiveis: 'Abastecimento, Conveni√™ncia, Lavagem, Restaurante',
      formas_pagamento: 'Dinheiro, Cart√£o, PIX, Vale',
      avaliacao: 4.5,
      total_avaliacoes: 120,
    },
  });

  console.log('‚úÖ Empresas criadas: Posto Dois Irm√£os e Posto Ipiranga Vila Maria');

  // 9. Criar Usu√°rios das Empresas
  console.log('üë• Criando Usu√°rios das Empresas...');
  
  // Admin do Posto Dois Irm√£os
  const adminDoisIrmaos = await prisma.usuario.upsert({
    where: { email: 'admin@postodoisirmaos.com.br' },
    update: {},
    create: {
      email: 'admin@postodoisirmaos.com.br',
      senha: hashedPassword,
      nome: 'Jo√£o dos Santos',
      cpf: '77777777777',
      tipo_usuario: 'ADMIN_EMPRESA',
      empresaId: postoDoisIrmaos.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82912345678',
    },
  });

  // Colaborador do Posto Dois Irm√£os
  const colaboradorDoisIrmaos = await prisma.usuario.upsert({
    where: { email: 'colaborador@postodoisirmaos.com.br' },
    update: {},
    create: {
      email: 'colaborador@postodoisirmaos.com.br',
      senha: hashedPassword,
      nome: 'Pedro Oliveira',
      cpf: '88888888888',
      tipo_usuario: 'COLABORADOR_EMPRESA',
      empresaId: postoDoisIrmaos.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82923456789',
    },
  });

  // Admin do Posto Ipiranga
  const adminIpiranga = await prisma.usuario.upsert({
    where: { email: 'admin@postoipiranga.com.br' },
    update: {},
    create: {
      email: 'admin@postoipiranga.com.br',
      senha: hashedPassword,
      nome: 'Maria dos Santos',
      cpf: '99999999999',
      tipo_usuario: 'ADMIN_EMPRESA',
      empresaId: postoIpiranga.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82987654321',
    },
  });

  // Colaborador do Posto Ipiranga
  const colaboradorIpiranga = await prisma.usuario.upsert({
    where: { email: 'colaborador@postoipiranga.com.br' },
    update: {},
    create: {
      email: 'colaborador@postoipiranga.com.br',
      senha: hashedPassword,
      nome: 'Ana Silva',
      cpf: '10101010101',
      tipo_usuario: 'COLABORADOR_EMPRESA',
      empresaId: postoIpiranga.id,
      statusAcess: 'Ativado',
      ativo: true,
      data_cadastro: new Date(),
      phone: '82976543210',
    },
  });

  console.log('‚úÖ Usu√°rios das Empresas criados');

  // 10. Criar Combust√≠veis
  console.log('‚õΩ Criando Combust√≠veis...');
  
  const combustiveis = [
    {
      nome: 'Gasolina Comum',
      sigla: 'GAS_COMUM',
      descricao: 'Gasolina comum para ve√≠culos leves',
    },
    {
      nome: 'Gasolina Aditivada',
      sigla: 'GAS_ADITIVADA',
      descricao: 'Gasolina com aditivos para melhor performance',
    },
    {
      nome: 'Etanol',
      sigla: 'ETANOL',
      descricao: 'Etanol hidratado para ve√≠culos flex',
    },
    {
      nome: 'Diesel S10',
      sigla: 'DIESEL_S10',
      descricao: 'Diesel com baixo teor de enxofre',
    },
  ];

  const combustiveisCriados = [];
  for (const combustivel of combustiveis) {
    const combustivelCriado = await prisma.combustivel.upsert({
      where: { sigla: combustivel.sigla },
      update: {},
      create: combustivel,
    });
    combustiveisCriados.push(combustivelCriado);
    console.log(`‚úÖ Combust√≠vel criado: ${combustivel.nome}`);
  }

  // 11. Criar Contratos
  console.log('üìÑ Criando Contratos...');
  
  // Contrato com Posto Dois Irm√£os
  const contratoDoisIrmaos = await prisma.contrato.create({
    data: {
      empresaId: postoDoisIrmaos.id,
      empresa_contratante: 'Prefeitura Municipal de Palmeira dos √çndios',
      empresa_contratada: 'Posto Dois Irm√£os Ltda',
      title: 'Contrato de Fornecimento de Combust√≠veis - Posto Dois Irm√£os',
      cnpj_empresa: postoDoisIrmaos.cnpj,
      vigencia_inicio: new Date('2024-01-01'),
      vigencia_fim: new Date('2024-12-31'),
      ativo: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    },
  });

  // Contrato com Posto Ipiranga
  const contratoIpiranga = await prisma.contrato.create({
    data: {
      empresaId: postoIpiranga.id,
      empresa_contratante: 'Prefeitura Municipal de Palmeira dos √çndios',
      empresa_contratada: 'Posto Ipiranga Vila Maria Ltda',
      title: 'Contrato de Fornecimento de Combust√≠veis - Posto Ipiranga',
      cnpj_empresa: postoIpiranga.cnpj,
      vigencia_inicio: new Date('2024-01-01'),
      vigencia_fim: new Date('2024-12-31'),
      ativo: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    },
  });

  console.log('‚úÖ Contratos criados');

  // 12. Criar Processo (Teto de Combust√≠vel)
  console.log('üìä Criando Processo (Teto de Combust√≠vel)...');
  
  const processo = await prisma.processo.create({
    data: {
      prefeituraId: prefeitura.id,
      numero_processo: '2024.001',
      numero_documento: '2024.001',
      tipo_documento: 'CONTRATO',
      objeto: 'Processo para controle de abastecimento de ve√≠culos da prefeitura',
      data_abertura: new Date('2024-01-01'),
      data_encerramento: new Date('2024-12-31'),
      status: 'ATIVO',
      ativo: true,
      observacoes: 'Processo para controle de abastecimento de ve√≠culos da prefeitura',
      valor_disponivel: 500000.00,
    },
  });

  console.log('‚úÖ Processo criado');

  // 13. Criar Solicita√ß√µes de Abastecimento de Exemplo
  console.log('‚õΩ Criando Solicita√ß√µes de Abastecimento de Exemplo...');
  
  const solicitacoes = [
    {
      veiculoId: veiculosCriados[0].id, // Ambul√¢ncia UTI 01
      motoristaId: motoristasCriados[0].id, // Jos√© da Silva Santos
      combustivelId: combustiveisCriados[0].id, // Gasolina Comum
      empresaId: postoDoisIrmaos.id,
      solicitanteId: secretarioSaude.id,
      tipo_abastecimento: 'COM_COTA' as any,
      quantidade: 50.0,
      valor_total: 275.00,
      data_abastecimento: new Date('2024-01-15'),
      status: 'Aprovado' as any,
    },
    {
      veiculoId: veiculosCriados[1].id, // Ambul√¢ncia B√°sica 02
      motoristaId: motoristasCriados[1].id, // Maria das Gra√ßas Oliveira
      combustivelId: combustiveisCriados[0].id, // Gasolina Comum
      empresaId: postoIpiranga.id,
      solicitanteId: secretarioSaude.id,
      tipo_abastecimento: 'COM_COTA' as any,
      quantidade: 40.0,
      valor_total: 218.00,
      data_abastecimento: new Date('2024-01-16'),
      status: 'Aprovado' as any,
    },
    {
      veiculoId: veiculosCriados[2].id, // Van Assist√™ncia Social
      motoristaId: motoristasCriados[2].id, // Ant√¥nio Carlos Ferreira
      combustivelId: combustiveisCriados[0].id, // Gasolina Comum
      empresaId: postoDoisIrmaos.id,
      solicitanteId: secretarioAssistencia.id,
      tipo_abastecimento: 'COM_COTA' as any,
      quantidade: 30.0,
      valor_total: 165.00,
      data_abastecimento: new Date('2024-01-17'),
      status: 'Aguardando' as any,
    },
  ];

  for (const solicitacao of solicitacoes) {
    await prisma.abastecimento.create({
      data: solicitacao,
    });
    console.log(`‚úÖ Solicita√ß√£o criada: Ve√≠culo ID ${solicitacao.veiculoId}`);
  }

  console.log('üéâ Seed completo conclu√≠do com sucesso!');
  console.log('\nüìã Resumo dos dados criados:');
  console.log('üëë Super Admin: superadmin@nordev.com (senha: 123456)');
  console.log('üèõÔ∏è Admin Prefeitura: admin@palmeiradosindios.al.gov.br (senha: 123456)');
  console.log('üë®‚Äçüíª Secret√°rio Sa√∫de: saude@palmeiradosindios.al.gov.br (senha: 123456)');
  console.log('üë®‚Äçüíª Secret√°rio Assist√™ncia: assistencia@palmeiradosindios.al.gov.br (senha: 123456)');
  console.log('üè¢ Admin Posto Dois Irm√£os: admin@postodoisirmaos.com.br (senha: 123456)');
  console.log('üè¢ Admin Posto Ipiranga: admin@postoipiranga.com.br (senha: 123456)');
  console.log('\nüöë Ve√≠culos: 4 ve√≠culos (2 ambul√¢ncias, 1 van social, 1 carro admin)');
  console.log('üöó Motoristas: 3 motoristas habilitados');
  console.log('‚õΩ Combust√≠veis: 4 tipos de combust√≠vel');
  console.log('üìÑ Contratos: 2 contratos ativos');
  console.log('üìä Processo: 1 processo com teto de R$ 500.000,00');
  console.log('‚õΩ Solicita√ß√µes: 3 solicita√ß√µes de exemplo');
  console.log('\nüîó Acesse a documenta√ß√£o em: http://localhost:3000/api/docs');
}

main()
  .catch((e) => {
    console.error('‚ùå Erro durante o seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });